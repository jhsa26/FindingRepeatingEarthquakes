#install the program
      
cd src 
bash build.sh
then you can find the program in  ../bin/

#data preparing ....

1.we need just one component such as E or Z or N; all sample rates are the same
2.all waveforms recorded by one station should have first arrival pick.
3.the t1 header must be marked with first arrival
3.header:  kevnm,kzdate,kztime,mag must be write into sac
5.all single components are put into "data_sac" folder
6.you can filter the waveforms due to the effect of noise to the correlation results

#script notes
1. write_header.sh 
   
   it is used to replace header t1 by using a if a is marked by the first arrival 
   and the waveforms without first arrival are delete from the data_sac folder. 
   if you have done data preparing, you don't run this script 

2.run.sh
  
  it is used to form the ccfile,and clusters stored in "Cluster" folder
  each cluster in "Cluster" folder has more than "minev" events

3.getcc1d.pl
  
  it is used  to form a correlation coefficient downtriangle matrix
  do correlation of each pair waveform 
  you can  change the window length and shifttime length in line 32
     
4.getcluster.awk
  
  output cluster information, although one cluster only have one piece of waveform
        
5.pltcluster.awk

  it originally plot all clusters in one plot, one color denote one cluster.
  now we don't use  it in "run.sh"

6.plot_repeating.sh
  
  it is used to plot single cluster, used in run.bash. 
  And, all plots are in Cluster not in output
  
  it uses obtian_shift.sh to obtain the shift of all events in one cluster relating to the first event.

7.obtain_shift_time.sh
  
  recorrelate in one cluster to obtain the shiftimes
 " the window length and shift length must be the same as those in getcc1d.pl"
# !!!! 
  if we use large shift time that makes the "t1-shifttime < b", the "corr1d" soft would show "the dt value seems too large for file", and then stop.
  so the ccfile would be out of order. so you would get wrong cluster result
  
  if the large shift time used, I change the output from corr1d using the same format that outputed with the proper shift time. but the cc value and shiftime are 0 and 999, respectively.

  

###################
# must have arrival time  P or S , if I do
# add a scripts to write the header
# add the head command to select the nevent
# add the obtain_shift.sh to obtain the shifttimes of all events in one cluster
# add plot_repeating.sh to plot a single cluster

# original explanation
1.create the file list and index list
  ls -1 *.sac >file.list
  ls -1 *.sac|gawk '{print NR,$1}' >index.list
2.calculate the cc matrix
  1.edit the getcorr1d.pl to define the windows and shift
  2../getcc1d.pl index.list >ccfile
3.hierarchical clustering
  always we want to use the maximum method to make event whithin
  each cluster more similar.
  ./cc2clusterHie  ccfile nevent 0.8 m 
4.output the final figure
  ./cc2clusterHie  ccfile nevent 0.8 m|paste - file.list|./getcluster.awk|./pltcluster.awk -v ps=output.ps|sh
  to get the final figure.
  
